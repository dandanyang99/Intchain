# 登录页面使用指南

## 功能概述

登录页面是用户进入系统的入口，支持用户名密码登录方式。

## 页面特性

### UI设计
- **渐变背景**：紫色渐变背景，视觉效果美观
- **卡片式布局**：白色卡片承载登录表单，层次分明
- **响应式设计**：适配不同屏幕尺寸
- **uView Plus组件**：使用uView Plus UI组件库，交互体验优秀

### 功能特性
- **表单验证**：前端验证用户名和密码
- **加载状态**：登录过程中显示加载动画
- **错误提示**：登录失败时显示友好的错误信息
- **自动跳转**：登录成功后自动跳转到首页
- **Token管理**：自动保存JWT token和用户信息

## 启动测试

### 1. 确保后端服务运行

确保以下服务正在运行：
- **Gateway**: http://localhost:5199
- **UserService**: http://localhost:5153

### 2. 启动前端开发服务器

```bash
cd e:\work\Intchain\frontend

# 微信小程序
npm run dev:mp-weixin

# H5 (浏览器)
npm run dev:h5
```

### 3. 打开应用

- **微信小程序**：使用微信开发者工具打开 `dist/dev/mp-weixin` 目录
- **H5**：浏览器访问 http://localhost:8080

## 测试场景

### 场景 1: 正常登录流程

1. 打开应用，自动进入登录页面
2. 输入用户名：`testuser`
3. 输入密码：`password123`
4. 点击"登录"按钮
5. **预期结果**:
   - 显示"登录中..."加载状态
   - 登录成功后显示"登录成功"提示
   - 1.5秒后自动跳转到首页
   - Token和用户信息已保存到本地存储

### 场景 2: 表单验证

**测试用户名为空**：
1. 密码输入框输入：`password123`
2. 用户名输入框留空
3. 点击"登录"按钮
4. **预期结果**：显示"请输入用户名"提示

**测试密码为空**：
1. 用户名输入框输入：`testuser`
2. 密码输入框留空
3. 点击"登录"按钮
4. **预期结果**：显示"请输入密码"提示

**测试密码长度不足**：
1. 用户名输入框输入：`testuser`
2. 密码输入框输入：`12345`（少于6位）
3. 点击"登录"按钮
4. **预期结果**：显示"密码长度不能少于6位"提示

### 场景 3: 登录失败处理

1. 输入错误的用户名或密码
2. 点击"登录"按钮
3. **预期结果**:
   - 显示"登录失败，请重试"或服务器返回的错误信息
   - 登录按钮恢复可用状态
   - 不会跳转页面

### 场景 4: 跳转到注册页面

1. 点击"立即注册"链接
2. **预期结果**：跳转到注册页面（需要先创建注册页面）

## 调试技巧

### 1. 查看请求日志

在开发环境下，所有请求和响应都会打印到控制台：
```
【请求】 http://localhost:5199/api/auth/login {...}
【响应】 http://localhost:5199/api/auth/login {...}
```

### 2. 查看本地存储

在浏览器开发者工具或微信开发者工具中查看本地存储：
- `intchain_token`: JWT token
- `intchain_user_info`: 用户信息（JSON 字符串）

### 3. 检查网络请求

使用开发者工具的Network面板查看：
- 请求URL是否正确
- 请求方法是否为POST
- 请求头是否包含正确的Content-Type
- 响应状态码和响应数据

## 常见问题

### Q1: 点击登录按钮没有反应

**可能原因**：
1. 表单验证未通过
2. 后端服务未启动
3. API网关地址配置错误

**解决方案**：
1. 检查控制台是否有错误提示
2. 确认Gateway和UserService正在运行
3. 检查 `src/config/api.config.js` 中的baseURL配置

### Q2: 登录请求返回404

**可能原因**：
1. API网关路由配置错误
2. UserService未启动
3. 请求路径不正确

**解决方案**：
1. 检查Gateway的ocelot.json配置
2. 确认UserService在5153端口运行
3. 确认请求路径为 `/api/auth/login`

### Q3: 登录成功但没有跳转

**可能原因**：
1. 首页路径配置错误
2. 首页组件不存在

**解决方案**：
1. 检查 `pages.json` 中是否有 `pages/index/index` 配置
2. 确认首页文件存在

### Q4: Token没有保存

**可能原因**：
1. 后端返回的数据格式不正确
2. 本地存储权限问题

**解决方案**：
1. 检查后端返回的数据结构，确保包含token字段
2. 检查浏览器或小程序的存储权限

## 页面文件说明

### 文件位置
- 页面文件：`frontend/src/pages/login/login.vue`
- 页面配置：`frontend/src/pages.json`
- API接口：`frontend/src/api/user.js`
- 认证工具：`frontend/src/utils/auth.js`
- 请求封装：`frontend/src/utils/request.js`

### 关键代码

**登录API调用**：
```javascript
const response = await login({
  username: this.formData.username,
  password: this.formData.password
})
```

**保存认证信息**：
```javascript
setToken(response.token)
setUserInfo(response.userInfo)
```

**跳转到首页**：
```javascript
uni.reLaunch({
  url: '/pages/index/index'
})
```

## 后续优化建议

### 功能增强
1. **记住密码**：添加"记住密码"选项
2. **忘记密码**：添加密码找回功能
3. **第三方登录**：支持微信一键登录
4. **验证码**：添加图形验证码或短信验证码
5. **角色选择**：登录时选择角色（管理员、彩票中心、印刷厂、销售网点）

### UI优化
1. **动画效果**：添加页面进入和表单提交动画
2. **深色模式**：支持深色主题
3. **多语言**：支持中英文切换
4. **无障碍**：优化无障碍访问体验

### 安全增强
1. **密码强度检测**：实时显示密码强度
2. **登录限制**：限制登录失败次数
3. **设备绑定**：记录登录设备信息
4. **异常登录提醒**：检测异常登录行为

---

**文档创建时间**: 2026-01-18
**文档版本**: 1.0
**适用范围**: Intchain前端登录页面
